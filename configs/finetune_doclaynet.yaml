# Fine-tuning configuration for DocLayNet dataset

model:
  backbone: "timm/vit_pe_spatial_base_patch16_512.fb"
  num_classes: 11  # DocLayNet classes
  freeze_backbone: true  # Freeze backbone during fine-tuning
  use_pretrained_backbone: true
  pretrained_checkpoint: "outputs/pretrain_publaynet/checkpoints/best_model.pth"

detr:
  # Deformable DETR architecture parameters (same as pretraining)
  num_queries: 300
  encoder_layers: 6
  decoder_layers: 6
  encoder_attention_heads: 8
  decoder_attention_heads: 8
  encoder_ffn_dim: 1024
  decoder_ffn_dim: 1024
  num_feature_levels: 4
  decoder_n_points: 4
  encoder_n_points: 4

data:
  dataset: "doclaynet"
  train_split: "train"
  val_split: "val"
  image_size: 512
  batch_size: 8
  num_workers: 8

augmentation:
  multi_scale_sizes: [480, 512, 544, 576, 608, 640]
  max_long_side: 928
  rotate_limit: 5
  rotate_prob: 0.5
  perspective:
    probability: 0.3
    scale_min: 0.02
    scale_max: 0.05
  elastic:
    probability: 0.2
    alpha: 30
    sigma: 5
  brightness_contrast:
    limit: 0.2
    probability: 0.5
  blur:
    probability: 0.3
    blur_limit: 3
  compression:
    probability: 0.3
    quality_min: 75
    quality_max: 100
  noise:
    probability: 0.2
    std_min: 0.0
    std_max: 0.01

training:
  # TrainingArguments parameters - passed as **kwargs
  num_train_epochs: 20  # Fewer epochs for fine-tuning
  learning_rate: 5.0e-5  # Lower LR for fine-tuning
  weight_decay: 1.0e-4
  warmup_steps: 500
  gradient_accumulation_steps: 1
  bf16: true
  save_steps: 500
  eval_steps: 500
  logging_steps: 50
  eval_strategy: "steps"
  save_strategy: "steps"
  save_total_limit: 3
  load_best_model_at_end: true
  metric_for_best_model: "eval_loss"
  greater_is_better: false
  push_to_hub: false

output:
  output_dir: "outputs/finetune_doclaynet"
  checkpoint_dir: "outputs/finetune_doclaynet/checkpoints"
  log_dir: "outputs/finetune_doclaynet/logs"
